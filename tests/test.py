import sys
import os
sys.path.append('../../')
from py_aduc_upload import AducConnection


def test_verify_shift():
    ad=AducConnection()
    shifted=ad._verifyShift([0x01<<b for b in range(8)])
    print(['0x%02x'%s for s in shifted])


def test_checksum():
    ad=AducConnection()
    tests=[ # (data,expected)
        ([0x05,0x52,0x00,0x00,0x00,0x01],0x00),
        ([0x06,0x45,0x00,0x00,0x00,0x00,0x01,
          0xb4,0x00,0x00,0x00,0x00,0x00,0x00,
          0x00,0x00,0x00,0x00,0x00,0x00,0x00,
          0x00,0x00,0x00,0x00,0x00,0x00,0x00,
          0x00,0x00,0x00,0x07,0x07,0x07,0x0e,
          0x06,0x45,0x00,0x00,0x00,0x00,0x01]
          ,0xb4)
        ]
    ret=True
    for data,expected in tests:
        result=ad._checksum(data) # ignore pylint:protected-access
        print(f'{data} = {result} expected {expected} ... {result==expected}')
        assert result==expected

